//package com.yishi.bson;
//
//import org.bson.Document;
//
//import java.util.ArrayList;
//import java.util.List;
//import java.util.Map;
//import java.util.regex.Matcher;
//import java.util.regex.Pattern;
//
///**
// * @date 2019年1月4日 10点32分
// * @auth yishi
// * @desc 使用路径来寻找json对象
// */
//public class BsonSelector {
//    private static final Pattern ARR_PATTERN= Pattern.compile("^(?<name>[^\\[]+)(?<index>(?:\\[(?:[^\\]]+)*\\])+)$");
//    private static final Pattern INDEX_PATTERN=Pattern.compile("\\[(?<index>[^\\]]+)*\\]");
//    public static <T> T select(Document document, String path,Class<T> clazz) {
//        return (T) select(document, path);
//    }
//    public static Object select(Document document, String path){
////        long start=System.nanoTime();
//        Object obj=select_(document, path);
////        System.out.format("find in %f millis\n",(System.nanoTime()-start)/1000000d);
//        return obj;
//    }
//
//    private static Object select_(Document document, String path) {
//
//        if (document == null) {
//            return null;
//        }
//        if (path == null) {
//            return document;
//        }
//        path = path.trim();
//        if (path.equals("/") || path.equals("")) {
//            return document;
//        }
//
//        String[] arr = path.split("/");
//        if (path.contains("//")) {//不确定路径逻辑，暂不实现
//            throw new IllegalArgumentException("暂未实现不确定路径逻辑");
//        } else {//根路径逻辑
//            int i = 0;
//            if (arr[0].equals("")) {
//                //修正起始值
//                i = 1;
//            } else {
//                i = 0;
//            }
//            Map doc = document;
//            List<Map> list = null;
//            for (; i < arr.length; i++) {
//                String docPath = arr[i];
//                if (docPath.endsWith("]")) {
//                    Matcher matcher = ARR_PATTERN.matcher(docPath);
//                    if (matcher.find()) {
//                        String name=matcher.group("name");
//                        String index=matcher.group("index");
//                        list = (List<Map>) doc.get(name);
//                        System.out.println(index);
//                        Matcher indexMatcher=INDEX_PATTERN.matcher(index);
//                        List<String> indexlist=new ArrayList<>();
//                        while (indexMatcher.find()&&!indexMatcher.hitEnd()){
//                            String index_=indexMatcher.group("index");
//                            indexlist.add(index_);
//                        }
//                        for(int j=0;j<indexlist.size();j++){
//                            String veryIndex=indexlist.get(j);
//                            if(veryIndex==null){
//                                if(j<indexlist.size()-1)
//                                {
//                                    throw new IllegalArgumentException("只有最后一个[]可以不给index");
//                                }else{
//                                    return list;
//                                }
//                            }else{
//                                boolean foundFlag=false;
//                                String currentPath=null;
//                                if(veryIndex.startsWith("'")){
//                                    String index_=veryIndex.substring(1,veryIndex.length()-1);
//                                    for(Object mapObj:list){
//                                        if(mapObj instanceof Map){
//                                            Map map= (Map) mapObj;
//                                            Object indirectReturn;
//                                            if((indirectReturn=map.get(index_))!=null){
//                                                if(map instanceof Map){
//                                                    if(j<indexlist.size()-1){
//                                                        throw new IllegalArgumentException("给的[]多于实际结构");
//                                                    }else{
//                                                        doc= map;
//                                                        foundFlag=true;
//                                                        break;
//                                                    }
//                                                }else  {
//                                                    throw new IllegalArgumentException("位置错误");
//                                                }
//
//                                            }
//                                        }
//
//
//
//                                    }
//
//                                }else if(veryIndex.startsWith("@")){
//                                    int equalPosition;
//                                    if((equalPosition=veryIndex.indexOf("="))>-1){
//                                        String key=veryIndex.substring(1, equalPosition);
//                                        String val=veryIndex.substring(equalPosition+1, veryIndex.length());
//                                        if(key.startsWith("'")){
//                                            key=key.substring(1, key.length()-1);
//                                        }else{
//                                            key=key.trim();
//                                        }
//                                        if(val.startsWith("'")){
//                                            val=val.substring(1, val.length()-1);
//                                        }else{
//                                            val=val.trim();
//                                        }
//                                        for(Object mapObj:list){
//                                            if(mapObj instanceof Map){
//                                                Map map= (Map) mapObj;
//                                                Object indirectReturn;
//                                                indirectReturn=map.get(key);
//                                                if(String.valueOf(indirectReturn).equals(val)){
//                                                    if(j<indexlist.size()-1){
//                                                        throw new IllegalArgumentException("给的[]多于实际结构");
//                                                    }else{
//                                                        doc= map;
//                                                        foundFlag=true;
//                                                    }
//                                                    break;
//                                                }
//                                            }
//
//                                        }
//                                    }else{
//                                        throw new IllegalArgumentException("@后应该是一个boolean 表达式");
//                                    }
//                                }else{
//                                    Object indirectReturn=list.get(Integer.valueOf(veryIndex));
//                                    if(indirectReturn instanceof Map){
//                                        if(j<indexlist.size()-1){
//                                            throw new IllegalArgumentException("给的[]多于实际结构");
//                                        }else{
//                                            doc= (Map) indirectReturn;
//                                            foundFlag=true;
//
//                                        }
//                                    }else if(indirectReturn instanceof List){
//                                        if(j<indexlist.size()-1){
//                                            list= (List) indirectReturn;
//                                            foundFlag=true;
//                                        }else{
//                                           return indirectReturn;
//
//                                        }
//                                    }else {
//                                        throw new IllegalArgumentException("位置错误");
//                                    }
//                                }
//                                if(!foundFlag){
//                                    throw new IllegalArgumentException("按路径"+path+"寻找失败");
//                                }
//                            }
//                        }
//
//
//                    } else {
//                       throw new IllegalArgumentException("解析路径失败");
//                    }
//
//                } else {
//                    Object obj = doc.get(docPath);
//                    if (obj instanceof Map) {
//                        doc = (Map) obj;
//                    } else {
//                        return obj;
//                    }
//                }
//
//            }
//            return doc;
//        }
//    }
//
//    public static Object getVal(Document document,String key){
//        Map.Entry entry= (Map.Entry) document.get(key);
//        return null;
//    }
//
//    static String json = "[{\"$match\":{\"templateId\":8}},{\"$project\":{\"_id\":1,\"reportId\":1,\"year\":1,\"templateId\":1,\"templateType\":1,\"issueDate\":1,\"periodNum\":1,\"report\":1,\"data\":1,\"fileReportDate\":1,\"quarter\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",3]},\"then\":1,\"else\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",6]},\"then\":2,\"else\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",9]},\"then\":3,\"else\":4}}}}}},\"halfYear\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",6]},\"then\":0,\"else\":1}}}},{\"$unwind\":{\"path\":\"$data\"}},{\"$group\":{\"1\":{\"$push\":\"$data.data.1\"},\"2\":{\"$push\":\"$data.data.2\"},\"3\":{\"$push\":\"$data.data.3\"},\"11\":{\"$push\":\"$data.data.11\"},\"12\":{\"$push\":\"$data.data.12\"},\"13\":{\"$push\":\"$data.data.13\"},\"14\":{\"$push\":\"$data.data.14\"},\"15\":{\"$push\":\"$data.data.15\"},\"16\":{\"$push\":\"$data.data.16\"},\"21\":{\"$push\":\"$data.data.21\"},\"22\":{\"$push\":\"$data.data.22\"},\"23\":{\"$push\":\"$data.data.23\"},\"24\":{\"$push\":\"$data.data.24\"},\"25\":{\"$push\":\"$data.data.25\"},\"26\":{\"$push\":\"$data.data.26\"},\"31\":{\"$push\":\"$data.data.31\"},\"32\":{\"$push\":\"$data.data.32\"},\"33\":{\"$push\":\"$data.data.33\"},\"34\":{\"$push\":\"$data.data.34\"},\"35\":{\"$push\":\"$data.data.35\"},\"36\":{\"$push\":\"$data.data.36\"},\"_id\":{\"year\":\"$year\"},\"001002001\":{\"$push\":\"$data.data.001002001\"},\"001002002\":{\"$push\":\"$data.data.001002002\"},\"001003001\":{\"$push\":\"$data.data.001003001\"},\"001003002\":{\"$push\":\"$data.data.001003002\"},\"_sum\":{\"$push\":\"$data.data._sum\"}}},{\"$sort\":{\"_id.periodNum\":1}},{\"$project\":{\"1\":{\"$reduce\":{\"input\":\"$1\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"2\":{\"$reduce\":{\"input\":\"$2\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"3\":{\"$reduce\":{\"input\":\"$3\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"11\":{\"$reduce\":{\"input\":\"$11\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"12\":{\"$reduce\":{\"input\":\"$12\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"13\":{\"$reduce\":{\"input\":\"$13\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"14\":{\"$reduce\":{\"input\":\"$14\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"15\":{\"$reduce\":{\"input\":\"$15\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"16\":{\"$reduce\":{\"input\":\"$16\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"21\":{\"$reduce\":{\"input\":\"$21\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"22\":{\"$reduce\":{\"input\":\"$22\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"23\":{\"$reduce\":{\"input\":\"$23\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"24\":{\"$reduce\":{\"input\":\"$24\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"25\":{\"$reduce\":{\"input\":\"$25\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"26\":{\"$reduce\":{\"input\":\"$26\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"31\":{\"$reduce\":{\"input\":\"$31\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"32\":{\"$reduce\":{\"input\":\"$32\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"33\":{\"$reduce\":{\"input\":\"$33\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"34\":{\"$reduce\":{\"input\":\"$34\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"35\":{\"$reduce\":{\"input\":\"$35\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"36\":{\"$reduce\":{\"input\":\"$36\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001002001\":{\"$reduce\":{\"input\":\"$001002001\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001002002\":{\"$reduce\":{\"input\":\"$001002002\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001003001\":{\"$reduce\":{\"input\":\"$001003001\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001003002\":{\"$reduce\":{\"input\":\"$001003002\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"_sum\":{\"$reduce\":{\"input\":\"$_sum\",\"initialValue\":{},\"in\":{}}}}}]";
//    static String json1 = "{\"collectionName\":\"report\",\"conditions\":[{\"$match\":{\"templateId\":8}},{\"$project\":{\"_id\":1,\"reportId\":1,\"year\":1,\"templateId\":1,\"templateType\":1,\"issueDate\":1,\"periodNum\":1,\"report\":1,\"data\":1,\"fileReportDate\":1,\"quarter\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",3]},\"then\":1,\"else\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",6]},\"then\":2,\"else\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",9]},\"then\":3,\"else\":4}}}}}},\"halfYear\":{\"$cond\":{\"if\":{\"$lte\":[\"$periodNum\",6]},\"then\":0,\"else\":1}}}},{\"$unwind\":{\"path\":\"$data\"}},{\"$group\":{\"1\":{\"$push\":\"$data.data.1\"},\"2\":{\"$push\":\"$data.data.2\"},\"3\":{\"$push\":\"$data.data.3\"},\"11\":{\"$push\":\"$data.data.11\"},\"12\":{\"$push\":\"$data.data.12\"},\"13\":{\"$push\":\"$data.data.13\"},\"14\":{\"$push\":\"$data.data.14\"},\"15\":{\"$push\":\"$data.data.15\"},\"16\":{\"$push\":\"$data.data.16\"},\"21\":{\"$push\":\"$data.data.21\"},\"22\":{\"$push\":\"$data.data.22\"},\"23\":{\"$push\":\"$data.data.23\"},\"24\":{\"$push\":\"$data.data.24\"},\"25\":{\"$push\":\"$data.data.25\"},\"26\":{\"$push\":\"$data.data.26\"},\"31\":{\"$push\":\"$data.data.31\"},\"32\":{\"$push\":\"$data.data.32\"},\"33\":{\"$push\":\"$data.data.33\"},\"34\":{\"$push\":\"$data.data.34\"},\"35\":{\"$push\":\"$data.data.35\"},\"36\":{\"$push\":\"$data.data.36\"},\"_id\":{\"year\":\"$year\"},\"001002001\":{\"$push\":\"$data.data.001002001\"},\"001002002\":{\"$push\":\"$data.data.001002002\"},\"001003001\":{\"$push\":\"$data.data.001003001\"},\"001003002\":{\"$push\":\"$data.data.001003002\"},\"_sum\":{\"$push\":\"$data.data._sum\"}}},{\"$sort\":{\"_id.periodNum\":1}},{\"$project\":{\"1\":{\"$reduce\":{\"input\":\"$1\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"2\":{\"$reduce\":{\"input\":\"$2\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"3\":{\"$reduce\":{\"input\":\"$3\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"11\":{\"$reduce\":{\"input\":\"$11\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"12\":{\"$reduce\":{\"input\":\"$12\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"13\":{\"$reduce\":{\"input\":\"$13\",\"initialValue\":{\"1544162619283\":0},\"in\":{\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"14\":{\"$reduce\":{\"input\":\"$14\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"15\":{\"$reduce\":{\"input\":\"$15\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"16\":{\"$reduce\":{\"input\":\"$16\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"21\":{\"$reduce\":{\"input\":\"$21\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"22\":{\"$reduce\":{\"input\":\"$22\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"23\":{\"$reduce\":{\"input\":\"$23\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"24\":{\"$reduce\":{\"input\":\"$24\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"25\":{\"$reduce\":{\"input\":\"$25\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"26\":{\"$reduce\":{\"input\":\"$26\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"31\":{\"$reduce\":{\"input\":\"$31\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"32\":{\"$reduce\":{\"input\":\"$32\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"33\":{\"$reduce\":{\"input\":\"$33\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"34\":{\"$reduce\":{\"input\":\"$34\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"35\":{\"$reduce\":{\"input\":\"$35\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"36\":{\"$reduce\":{\"input\":\"$36\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001002001\":{\"$reduce\":{\"input\":\"$001002001\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001002002\":{\"$reduce\":{\"input\":\"$001002002\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001003001\":{\"$reduce\":{\"input\":\"$001003001\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"001003002\":{\"$reduce\":{\"input\":\"$001003002\",\"initialValue\":{\"1543981917949\":0,\"1543981925524\":0,\"1544162619283\":0},\"in\":{\"1543981917949\":{\"$add\":[\"$$value.1543981917949\",{\"$ifNull\":[\"$$this.1543981917949\",0]}]},\"1543981925524\":{\"$add\":[\"$$value.1543981925524\",{\"$ifNull\":[\"$$this.1543981925524\",0]}]},\"1544162619283\":{\"$add\":[\"$$value.1544162619283\",{\"$ifNull\":[\"$$this.1544162619283\",0]}]}}}},\"_sum\":{\"$reduce\":{\"input\":\"$_sum\",\"initialValue\":{},\"in\":{}}}}}]}";
//    static String json2="{  a: {    a1: [      [        {          b: '1',c:2        }      ],      [        {          c: '2'        }      ]    ],    b1: [      {        d: 2      }    ]  }}" ;
//
//    public static void main(String[] args) {
////        BSONDecoder decoder = new BasicBSONDecoder();
////        List<Document> conditions= JSON.parseArray(json, Document.class);
////        System.out.println(conditions);
////        BsonDocument document=BsonDocument.parse(json);
////        Document document=Document.parse(json);
//        Document document = null;
////        BsonArray bsonValues=BsonArray.parse(json);
////        System.out.println(bsonValues);
//        document = Document.parse(json2);
////        document=conditions.get(0);
//        System.out.println(json2);
////        System.out.println(BsonSelector.select(document, "/conditions[]"));
////        System.out.println(BsonSelector.select(document, "/$match/templateId").getClass());
//        Object document1=BsonSelector.select(document, "/a/a1[0]['b']/c");
//        System.out.println(document1);
//    }
//}
